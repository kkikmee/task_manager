<!-- templates/tasks/task_form.html -->
{% extends 'main/base.html' %}
{% load static %}

{% block title %}{{ title }} - Task Manager{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'main:dashboard' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'users:project_list' %}">–ü—Ä–æ–µ–∫—Ç—ã</a></li>
                    <li class="breadcrumb-item">
                        <a href="{% url 'main:project_detail' project.id %}">{{ project.name }}</a>
                    </li>
                    <li class="breadcrumb-item active">{{ title }}</li>
                </ol>
            </nav>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ñ–æ—Ä–º—ã -->
            <div class="card shadow">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">
                            <i class="bi bi-plus-circle me-2"></i>{{ title }}
                        </h4>
                        <p class="mb-0 text-muted small">–ü—Ä–æ–µ–∫—Ç: <strong>{{ project.name }}</strong></p>
                    </div>
                    <div class="project-color" style="width: 30px; height: 30px; background-color: {{ project.color }}; border-radius: 4px;"></div>
                </div>
                <div class="card-body p-4">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <!-- –í—ã–≤–æ–¥ –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º—ã -->
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    <p class="mb-0">{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="row">
                            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="col-lg-8">
                                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
                                <div class="mb-4">
                                    <label for="{{ form.title.id_for_label }}" class="form-label fw-bold">
                                        –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *
                                    </label>
                                    {{ form.title }}
                                    {% if form.title.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.title.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">–ö—Ä–∞—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É</div>
                                </div>

                                <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                                <div class="mb-4">
                                    <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">
                                        –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
                                    </label>
                                    {{ form.description }}
                                    {% if form.description.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.description.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">
                                        –î–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É, –¥–æ–±–∞–≤—å—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                                    </div>
                                </div>

                                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                <div class="card border-light mb-4">
                                    <div class="card-body">
                                        <h6 class="card-title text-primary mb-3">
                                            <i class="bi bi-info-square me-2"></i>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                                        </h6>
                                        <p class="small text-muted mb-0">
                                            <i class="bi bi-lightbulb text-warning me-1"></i>
                                            –ó–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É "{{ project.name }}"
                                        </p>
                                        {% if task %}
                                            <p class="small text-muted mb-0 mt-1">
                                                <i class="bi bi-clock text-info me-1"></i>
                                                –°–æ–∑–¥–∞–Ω–∞: {{ task.created_at|date:"d.m.Y H:i" }}
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ -->
                            <div class="col-lg-4">
                                <div class="sticky-top" style="top: 20px;">
                                    <!-- –°—Ç–∞—Ç—É—Å -->
                                    <div class="mb-4">
                                        <label for="{{ form.status.id_for_label }}" class="form-label fw-bold">
                                            –°—Ç–∞—Ç—É—Å
                                        </label>
                                        {{ form.status }}
                                        {% if form.status.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.status.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>

                                    <!-- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç -->
                                    <div class="mb-4">
                                        <label for="{{ form.priority.id_for_label }}" class="form-label fw-bold">
                                            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                                        </label>
                                        {{ form.priority }}
                                        {% if form.priority.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.priority.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <div class="form-text small">
                                            <i class="bi bi-circle-fill text-danger me-1"></i> –í—ã—Å–æ–∫–∏–π - —Å—Ä–æ—á–Ω–æ
                                            <br>
                                            <i class="bi bi-circle-fill text-warning me-1"></i> –°—Ä–µ–¥–Ω–∏–π - –≤–∞–∂–Ω–æ
                                            <br>
                                            <i class="bi bi-circle-fill text-success me-1"></i> –ù–∏–∑–∫–∏–π - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
                                        </div>
                                    </div>

                                    <!-- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å -->
                                    <div class="mb-4">
                                        <label for="{{ form.assigned_to.id_for_label }}" class="form-label fw-bold">
                                            –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
                                        </label>
                                        {{ form.assigned_to }}
                                        {% if form.assigned_to.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.assigned_to.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <div class="form-text small">
                                            {% if project.team_members.count > 0 %}
                                                –î–æ—Å—Ç—É–ø–Ω–æ {{ project.team_members.count }} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                                            {% else %}
                                                <span class="text-warning">–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                                    <div class="mb-4">
                                        <label for="{{ form.due_date.id_for_label }}" class="form-label fw-bold">
                                            –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                                        </label>
                                        {{ form.due_date }}
                                        {% if form.due_date.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.due_date.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <div class="form-text small">
                                            –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É, –∫ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <a href="{% url 'main:project_detail' project.id %}" class="btn btn-outline-secondary">
                                            <i class="bi bi-arrow-left me-1"></i>–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç—É
                                        </a>
                                    </div>
                                    <div class="d-flex gap-2">
                                        {% if task %}
                                            <!-- –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
                                            <a href="{% url 'main:task_delete' task.id %}" class="btn btn-outline-danger" 
                                               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É \"{{ task.title }}\"?')">
                                                <i class="bi bi-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
                                            </a>
                                        {% endif %}
                                        <button type="submit" class="btn btn-primary px-4">
                                            <i class="bi bi-check-lg me-1"></i>
                                            {% if task %}–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É{% else %}–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É{% endif %}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card border-info">
                        <div class="card-body">
                            <h6 class="card-title text-info">
                                <i class="bi bi-lightbulb me-2"></i>–°–æ–≤–µ—Ç—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞–¥–∞—á–∏
                            </h6>
                            <ul class="small mb-0">
                                <li>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –∏–∑–º–µ—Ä–∏–º—ã–º</li>
                                <li>–î–æ–±–∞–≤—å—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏</li>
                                <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>
                                <li>–ù–∞–∑–Ω–∞—á—å—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</li>
                                <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-success">
                        <div class="card-body">
                            <h6 class="card-title text-success">
                                <i class="bi bi-clock me-2"></i>–†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
                            </h6>
                            <ul class="small mb-0">
                                <li><strong>–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</strong> - –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞</li>
                                <li><strong>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</strong> - —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π</li>
                                <li><strong>–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</strong> - –≥–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</li>
                                <li><strong>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</strong> - –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á -->
            {% if not task %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card border-warning">
                        <div class="card-header bg-warning bg-opacity-10">
                            <h6 class="mb-0">
                                <i class="bi bi-lightning me-2"></i>–ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary btn-sm w-100 quick-template" 
                                            data-title="–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∏–∑–∞–π–Ω" data-desc="–°–æ–∑–¥–∞—Ç—å –º–∞–∫–µ—Ç –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ">
                                        üé® –î–∏–∑–∞–π–Ω
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary btn-sm w-100 quick-template" 
                                            data-title="–ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é" data-desc="–°–æ–∑–¥–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –ø—Ä–æ–µ–∫—Ç—É">
                                        üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary btn-sm w-100 quick-template" 
                                            data-title="–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª" data-desc="–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞">
                                        üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.form-control:focus, .form-select:focus {
    border-color: #4e73df;
    box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e3e6f0;
}

.breadcrumb {
    background-color: transparent;
    padding: 0;
}

.breadcrumb-item a {
    text-decoration: none;
    color: #4e73df;
}

.breadcrumb-item.active {
    color: #6c757d;
}

.form-label {
    color: #495057;
}

.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #dc3545;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π */
textarea.form-control {
    min-height: 120px;
    resize: vertical;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ */
.form-select {
    cursor: pointer;
}

/* Sticky sidebar –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 992px) {
    .sticky-top {
        position: static !important;
    }
}

/* –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –º–µ—Ç–∫–∞ */
.project-color {
    border: 2px solid #dee2e6;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
.btn {
    transition: all 0.2s ease;
}

.quick-template:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã Bootstrap –∫ –ø–æ–ª—è–º —Ñ–æ—Ä–º—ã
    const textInputs = document.querySelectorAll('input[type="text"], textarea, select');
    textInputs.forEach(input => {
        if (!input.classList.contains('form-control') && !input.classList.contains('form-select')) {
            input.classList.add('form-control');
        }
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã (—Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å)
    const dueDateInput = document.getElementById('{{ form.due_date.id_for_label }}');
    if (dueDateInput && !dueDateInput.value) {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        dueDateInput.value = tomorrow.toISOString().split('T')[0];
    }

    // –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
    document.querySelectorAll('.quick-template').forEach(button => {
        button.addEventListener('click', function() {
            const title = this.getAttribute('data-title');
            const description = this.getAttribute('data-desc');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
            document.getElementById('{{ form.title.id_for_label }}').value = title;
            document.getElementById('{{ form.description.id_for_label }}').value = description;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            document.getElementById('{{ form.status.id_for_label }}').value = 'todo';
            document.getElementById('{{ form.priority.id_for_label }}').value = 'medium';
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è
            document.getElementById('{{ form.title.id_for_label }}').focus();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–®–∞–±–ª–æ–Ω "' + title + '" –ø—Ä–∏–º–µ–Ω–µ–Ω!', 'info');
        });
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const titleField = document.getElementById('{{ form.title.id_for_label }}');
        if (!titleField.value.trim()) {
            e.preventDefault();
            titleField.focus();
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏', 'error');
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        if (dueDateInput && dueDateInput.value) {
            const selectedDate = new Date(dueDateInput.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate < today) {
                if (!confirm('–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫?')) {
                    e.preventDefault();
                    dueDateInput.focus();
                    return false;
                }
            }
        }
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'info') {
        const alert = document.createElement('div');
        alert.className = `alert alert-${type === 'error' ? 'danger' : 'info'} alert-dismissible fade show`;
        alert.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;
        alert.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(alert);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (alert.parentNode) {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 150);
            }
        }, 5000);
    }

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ–± –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è—Ö
    const assignedSelect = document.getElementById('{{ form.assigned_to.id_for_label }}');
    if (assignedSelect) {
        assignedSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption.value) {
                console.log('–í—ã–±—Ä–∞–Ω –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:', selectedOption.text);
            }
        });
    }

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    const requiredFields = document.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        const label = document.querySelector(`label[for="${field.id}"]`);
        if (label) {
            const requiredMark = document.createElement('span');
            requiredMark.className = 'text-danger ms-1';
            requiredMark.textContent = '*';
            label.appendChild(requiredMark);
        }
    });
});
</script>
{% endblock %}